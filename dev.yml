# Generated by `dev init rails`.
# Working on a new project? Prefer running the generator to copying this file.
name: competency-tracker

# Define dependencies to run this service.
up:
  - homebrew:
    - openssl
    - shopify/shopify/mysql-client:
        or:        [mysql]
        conflicts: [mysql-connector-c]
  - ruby:
      version: ruby-2.3.0
  - railgun
  - bundler
  # - buildkite:
  #   - rails: true
  #
  # The database task will make sure your database has been bootstrapped,
  # and then run migrations for you when new migrations have been created.
  # NOTE: You will still have to change the connection strings in
  # config/database.yml to point at the IP assigned to the railgun VM.
  # See https://vault.shopify.com/dev#configuring-config-database-yml
  - database:
      bootstrap: bundle exec rake db:setup db:test:prepare
      migrate: bin/rake db:migrate db:test:prepare
      host: competency-tracker.railgun
      user: root
      password: ""
      # Confirm in config/database.yml that this is correct (some older apps are different).
      database: competency-tracker_development

# Add project-local commands. desc and run are required.
# the syntax property is kind of complex, but only used to generate output in
# `dev help`. You can leave it blank, or dig into the code in Dev::Help.
commands:
  console:
    syntax: ""
    desc:   'start a rails console'
    run:    bin/rails console
  server:
    syntax: ""
    desc:   'start a rails server'
    # You'll want to find the port registered for your app at:
    # https://github.com/Shopify/cookbooks/blob/master/cookbooks/shopify-dev/files/default/web_apps.json
    # If your app isn't in that list, just pick a random number between 10000 and 65535. e.g.:
    # ruby -e 'puts rand(10000..65534)'
    run:    bin/rails server -b 192.168.64.1 -p 62578
  test:
    syntax:
      argument: file
      optional: args...
    desc:   'run a single test file'
    run:    bin/rake spec

# These use fuzzy-matching, so you can `dev open ad` if you have a line with
# "Shopify Admin". You should change "My Application" to something else.
open:
  app: https://competency-tracker.myshopify.io

railgun:
  image: railgun-update.shopify.io:railgun-common-services-0.1.4
  services:
    redis:         6379
    memcached:    11211
    # toxiproxy:     8474
    mysql:         3306
    # elasticsearch: 9200
    # zookeeper:     2181
    # argus:         8001
    # magellan:      8438
    # imagery:      25300
    nginx:           80
  # Choose an unused IP. Add a line to
  # https://github.com/Shopify/dev/blob/master/IP_ADDRESSES to claim it.
  ip_address: 192.168.64.58
  memory: 2G
  # nginx will fail to start if you have fewer than 2 cores.
  cores: 2
  disk: 2G
  # proxy sets up an nginx config in the VM so that
  # https://competency-tracker.myshopify.io routes into the VM, and it then proxies back
  # out to the given port on your host OS X. "XXXX" here should be changed for
  # the same port you selected above in the commands->server->run line.
  proxy:
    competency-tracker.myshopify.io: 62578
